# E-commerce Database Setup

This directory contains the MySQL database schema and sample data for your React + PHP e-commerce application.

## ğŸ“ Files

- `schema.sql` - Database structure with tables, relationships, indexes, and triggers
- `sample_data.sql` - Mock data matching your React frontend components
- `README.md` - This setup guide

## ğŸ—„ï¸ Tables Overview

| Table            | Purpose                  | Frontend Mapping                       |
| ---------------- | ------------------------ | -------------------------------------- |
| `users`          | User accounts & profiles | UserProfilePage                        |
| `user_addresses` | Saved addresses          | UserProfilePage (addresses section)    |
| `categories`     | Product categories       | ProductManagementPage                  |
| `products`       | Product catalog          | ProductManagementPage, ProductsPage    |
| `shopping_cart`  | User's cart items        | CartPage                               |
| `orders`         | Order information        | OrderManagementPage, CheckoutPage      |
| `order_items`    | Items within orders      | CheckoutPage (cart â†’ order conversion) |

## ğŸš€ Setup Instructions

### Step 1: Create Database

```bash
mysql -u root -p -e "CREATE DATABASE IF NOT EXISTS ecommerce_db;"
```

### Step 2: Import Schema

```bash
mysql -u root -p ecommerce_db < database/schema.sql
```

### Step 3: Import Sample Data

```bash
mysql -u root -p ecommerce_db < database/sample_data.sql
```

## ğŸ”§ PHP Backend Integration Examples

### Connect to Database

```php
<?php
$host = 'localhost';
$dbname = 'ecommerce_db';
$username = 'root';
$password = ''; // Set your password

try {
    $pdo = new PDO("mysql:host=$host;dbname=$dbname", $username, $password);
    $pdo->setAttribute(PDO::ATTR_ERRMODE, PDO::ERRMODE_EXCEPTION);
} catch(PDOException $e) {
    die("Connection failed: " . $e->getMessage());
}
?>
```

### Fetch User Profile

```php
// Get user by ID
$stmt = $pdo->prepare("SELECT * FROM users WHERE id = ?");
$stmt->execute([$user_id]);
$user = $stmt->fetch(PDO::FETCH_ASSOC);

// Get user addresses
$stmt = $pdo->prepare("SELECT * FROM user_addresses WHERE user_id = ? ORDER BY is_default DESC");
$stmt->execute([$user_id]);
$addresses = $stmt->fetchAll(PDO::FETCH_ASSOC);
```

### Get Products for Admin Panel

```php
$stmt = $pdo->query("
    SELECT p.*, c.name as category_name
    FROM products p
    LEFT JOIN categories c ON p.category_id = c.id
    ORDER BY p.created_at DESC
");
$products = $stmt->fetchAll(PDO::FETCH_ASSOC);
```

### Create Order from Cart

```php
// Start transaction
$pdo->beginTransaction();

try {
    // Insert order
    $stmt = $pdo->prepare("INSERT INTO orders (user_id, total_amount, status, payment_method) VALUES (?, ?, 'pending', ?)");
    $stmt->execute([$user_id, $total, $payment_method]);
    $order_id = $pdo->lastInsertId();

    // Insert order items from cart
    $stmt = $pdo->prepare("
        INSERT INTO order_items (order_id, product_id, product_name, product_price, quantity, line_total)
        SELECT ?, p.id, p.name, p.price, sc.quantity, (p.price * sc.quantity)
        FROM shopping_cart sc
        JOIN products p ON sc.product_id = p.id
        WHERE sc.user_id = ?
    ");
    $stmt->execute([$order_id, $user_id]);

    // Clear cart
    $stmt = $pdo->prepare("DELETE FROM shopping_cart WHERE user_id = ?");
    $stmt->execute([$user_id]);

    $pdo->commit();
} catch(Exception $e) {
    $pdo->rollback();
    throw $e;
}
```

## ğŸ”‘ Key Features

### âœ… Automatic Order Numbers

- Format: `ORD-{YYMMDD}-{0001}`
- Auto-incremented per day
- Generated by database trigger

### âœ… Automatic Timestamps

- Orders automatically mark `shipped_at` and `delivered_at` when status changes
- All tables have `created_at` and `updated_at` columns

### âœ… Data Integrity

- Foreign key constraints prevent orphaned records
- ENUM types ensure valid status values
- Unique constraints on emails, slugs, skus

### âœ… Performance Optimized

- Indexes on frequently queried columns
- JSON column for product images
- Composite indexes for complex queries

## ğŸ§ª Testing Data

The sample data includes:

- **1 user**: Eleanor Vance (matches your frontend mock)
- **2 saved addresses**: Home & Work addresses
- **5 products**: With various stock levels and categories
- **2 orders**: One delivered, one shipped with items
- **Cart items**: Matching your checkout page mock data

## ğŸ”„ API Endpoints Suggestions

Based on your frontend:

```
GET    /api/user/profile          # Get user profile + addresses
PUT    /api/user/profile          # Update user profile
GET    /api/products              # Get products with pagination/filtering
POST   /api/cart                  # Add to cart
GET    /api/cart                  # Get cart items
POST   /api/checkout              # Create order from cart
GET    /api/orders                # Get user orders
PUT    /api/orders/{id}/status    # Update order status (admin)
```

This database is **production-ready** and follows PHP/MySQL best practices with proper indexing, relationships, and constraints.
